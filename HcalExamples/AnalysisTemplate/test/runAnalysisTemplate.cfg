process ANALYSIS = { 

	source = HcalTBSource {
		untracked vstring fileNames = {'file:/scratch/ratnikov/data/USC_000206.root'}
		untracked vstring streams = { 'HCAL_DCC718','HCAL_DCC719' }
		untracked int32 maxEvents = 2
	}

// unpacker
     	module hcalunpacker = HcalRawToDigi {
                int32 firstSample = 0
                int32 lastSample = 9
                untracked int32 HcalFirstFED = 700
                untracked vint32 FEDs = { 718, 719 }
		bool FilterDataQuality = true
		untracked bool UnpackCalib = false	
	}

// hits reconstruction. Note non-standard parameters
	module recohbhe = HcalSimpleReconstructor {
	        int32 firstSample = 4
	        int32 samplesToAdd = 4
	        string Subdetector = 'HBHE'
		InputTag digiLabel = hcalunpacker
	        bool correctForTimeslew = true
		bool correctForPhaseContainment = true
		double correctionPhaseNS = 10
	}

	module recoho = HcalSimpleReconstructor {
	        int32 firstSample = 4
	        int32 samplesToAdd = 4
	        string Subdetector = 'HO'
		InputTag digiLabel = hcalunpacker
	        bool correctForTimeslew = false
		bool correctForPhaseContainment = false
		double correctionPhaseNS = 0
	}	

	module recohf = HcalSimpleReconstructor {
	        int32 firstSample = 4
	        int32 samplesToAdd = 4
	        string Subdetector = 'HF'
		InputTag digiLabel = hcalunpacker
	        bool correctForTimeslew = false
		bool correctForPhaseContainment = false
		double correctionPhaseNS = 0
	}
// output events
        module out = PoolOutputModule
        { 
          untracked string fileName = "events.root"
        }

 // analysis itself
        module analysis = AnalysisTemplate {
               untracked string rootFile = "histograms.root"
        }

	path p = { hcalunpacker, recoho, recohf, recohbhe, analysis}
        endpath outpath = {out}


  es_module = HcalDbProducer {}
  es_source es_hardcode = HcalHardcodeCalibrations { untracked vstring toGet = {"Pedestals", "PedestalWidths", "Gains", "GainWidths", "QIEShape", "QIEData", "ChannelQuality"}}

  es_source es_ascii = HcalTextCalibrations { VPSet input = {
                                                {string object = "ElectronicsMap"
                                                 FileInPath file = "HcalExamples/AnalysisTemplate/data/hfplusmap.txt"
                                                }
                                            }
  }
}